<!DOCTYPE html>
<html>
<head>
    <title>Ropa Inteligente - Prueba de Mapa (Simulación)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIINfBG9z7L07adHvPtPmXoXY1FD3EV8PlE="
        crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20n6a4yRD0PshR4X5dJ+Ngyc8K1k6iB73pXn3JbH0eA="
        crossorigin=""></script>
    
    <style>
        #map { height: 100vh; width: 100%; } 
    </style>
</head>
<body>
    <div id="map"></div>

    <script>
        let map;
        let gpsMarker;

        // ---------------------- FUNCIONES DE SIMULACIÓN ----------------------
        function simulateUpdate(lat, lng) {
            const newPos = [lat, lng];
            
            // Mover el marcador
            gpsMarker.setLatLng(newPos);
            
            // Centrar el mapa en la nueva ubicación (zoom 15)
            map.setView(newPos, 15); 
            console.log("Ubicación simulada cargada:", newPos);
        }

        // ---------------------- 1. INICIALIZAR LEAFLET MAPS ----------------------
        function initMap() {
            // Coordenadas fijas de prueba (ej: Guatemala City)
            const TEST_LAT = 14.6284;
            const TEST_LNG = -90.5228;
            const initialPos = [TEST_LAT, TEST_LNG]; // [Lat, Lng]
            
            // Crea el mapa y lo centra
            map = L.map('map').setView(initialPos, 15);

            // Añade la capa de mosaicos de OpenStreetMap
            L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);

            // Crea el marcador inicial
            gpsMarker = L.marker(initialPos).addTo(map)
                .bindPopup("Ubicación de Prueba (Simulación)").openPopup();
            
            // ⚠️ Ejecuta la simulación inmediatamente al cargar el mapa
            simulateUpdate(TEST_LAT, TEST_LNG); 
            
            // NO se necesita iniciar la conexión MQTT en esta versión
        }

        window.onload = initMap;
    </script>
</body>
</html>